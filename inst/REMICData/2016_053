  
  # This file builds REMIC 2016 58
  require(BondLab)
  
  # Structuring a REMIC requires the following classes 
  # 1 -- RAID file REMIC At Issuance Disclosure
  # 2 -- TRANCHES are also required currently TRANCHES are created using the 
  # MakeTRANCES function
  # 3 -- RDME file REMIC Disclosure Month End
  # 4 -- COLLATERAL This holds the pools and original balances contributed to 
  # the REMIC.  This may require to make a COLLATERALGROUP Repline if not using 
  # pools and/or collateral assumption at 0 PSA if required.
  # 5 --  Structural Elements refers to PAC/TAC schedules and balances
  
  # Construction of the REMIC follows the REMIC relay files
  # First in the REMIC Relay Files is the Deal Information
  # which is used to create the Bond Lab RAID file.  The MakeRAID
  # function is used to create the RAID class and saves it as a .rds
  # file in the RAID folder 
  
  MakeRAID(
  DealName = "FNMA2016053",
  Issuer = "FNMA",
  DealNumber = "2016-058",
  DealPriceDate = "07-02-2016",
  DealSettlementDate = "07-29-2016",
  Underwriter = "Amherst Securities",
  Trustee = "FANNIE MAE",
  PricingSpeed = 185,
  JumpReferenceSpeed1 = 0,
  JumpReferenceSpeed2 = 0,
  JumpReferenceSpeed3 = 0,
  JumpReferenceSpeed4 = 0,
  JumpReferenceSpeed5 = 0,
  NumberofTranches = 30,
  NumberofComponentTranches = 0,
  NumberofCombinedTranches = 0,
  NumberofPools = 0,
  PacSchedulesIncluded = FALSE,
  NumberofPacSchedules = 0,
  NumberofGroups = 1,
  DealSize = 356278104,
  CollateralAmount = 356278104,
  CollateralAvgLife = 7.14395,
  BondValue = 356278104,
  BondValueMethod = "PASSTHRU",
  BondValueCap = 0,
  BondValueDiscountRate = 0,
  BondValueReinvestmentRate = 0,
  ExpenseBasisPointFee = 0,
  ExpenseFixed = 0,
  ExpensePeriodicity = 0,
  InitialReserveFund = 0)
  
  # The collateral group information is next in the REMIC relay
  # file and is used to create the collateral groups.  Each group will
  # need a unique cusip that must be 9 characters long.  The MakeMBSDetails
  # function is used to create the collateral group.  The deal could also call
  # the pools from a pool database.  If collatreal groups are used need to 
  # come up with a cusip scheme to assign a unique cusip to a REMIC collateral
  # group.  
  # 
  # Note: for the purpose of the decrement table at 0% PSA collateral 
  # group 1 is assumed to have a GWac of 6.5 and a pass-through coupon rate 
  # of 4.00. The age is 0 and the remaining term is 360.  This is legal last
  # payment date and the deal will be tied to this decrement table.
  
  MakeMBSDetails(
  Cusip = "201605301FNR20160531",
  ID = "201605301FNR20160531",
  BondType = "MBS",
  Sector = "MBS",
  Coupon = 4.0,
  IssueDate = "07-01-2016",
  DatedDate = "07-01-2016",
  Maturity = "07-01-2046",
  LastPmtDate = "07-01-2016",
  NextPmtDate = "08-01-2016",
  Term = 360,
  WALA = 0,
  WAM = 359,
  PaymentDelay = 24,
  Moody = "AAA",
  SP = "Aaa",
  BondLab ="AAA",
  Frequency = 12,
  BondBasis = "30360",
  GWac = 4.45,
  OrigLoanBal = 250000,
  OrigLTV = 80,
  AmortizationType = "fixed",
  AmortizationTerm = 30,
  Index = "None",
  Margin = 0,
  FirstPmtDate = "08-01-2016",
  FinalPmtDate = "08-01-2046",
  Servicing = 0.25,
  PMI = 0,
  GFeePremium = 0.29,
  InitialInterest = FALSE,
  FirstPrinPaymentDate = "06-01-2016",
  BalloonPmt = FALSE,
  BalloonDate = "00-00-0000",
  MBSFactor = 1.0,
  OriginalBal = 356278104,
  CurrentBal = 356278104,
  Model = "FN30.Generic",
  Burnout = 25,
  SATO = 0.00
  )
  
  # The tranche information is assembled next create each individual tranche
  # and store the data in the tranches database. Each Tranche is modeled from
  # the REMIC Relay file data.  Delay days are used to define the interest and
  # principal passed to the REMIC tranche based on the underlying cashflow 
  # received.
  
  MakeTranche(
  DealName = "FNMA2016053",
  TrancheNumber = "1",
  NumberofComponents = 0,
  ComponentofTranches = "0",
  TrancheName = "053-AF",
  TranchePrincipal = "pass-through",
  TranchePrincipalDesc = "PT",
  TrancheInterestDesc = "FLT",
  TrancheOtherDesc = "",
  Cusip = "3136AS4X1",
  TrancheOrigBal = 38400349,
  TrancheInterest = "FLT",
  TrancheCoupon = 0.95,
  AccrualRate = 0,
  TreasuryMaturity = 0,
  TreasuryYield = 0,
  TreasurySpread = 0,
  TrancheYield = 0,
  TranchePrice = 0,
  TrancheProceedsWithInterest = 0,
  TrancheAvgLife = 7.03937,
  TrancheDuration = 4.70661,
  TrancheDatedDate = "07-25-2016",
  TrancheFirstPmtDate = "08-25-2016",
  TrancheNextPmtDate = "08-25-2016",
  TrancheLastPmtDate = "02-25-2045",
  TrancheFinalPmtDate = "08-25-2046",
  Delay = 0,
  InterestPmtFrequency = 12,
  PrinPmtFrequency = 12,
  PacLowBand = 0,
  PacHighBand = 0,
  FloaterIndex = "LIBOR1BBA",
  InitialIndexValue = 0.45,
  FloaterMargin = 0.50,
  FloaterMultiplier = 1.0,
  FloaterCap = 6.50,
  FloaterFloor = 0.5,
  FloaterInitialCoupon = 0.95,
  FloaterResetFrequency = 12,
  FloaterFirstResetDate = "08-25-2016",
  FloaterFormula = function(Cap, Floor, Margin, Index, Multiplier){
  min(Cap, max((Index * Multiplier) + Margin, Floor))},
  Group = 1,
  Schedule = FALSE,
  Fixed = FALSE)
  
  MakeTranche(
  DealName = "FNMA2016053",
  TrancheNumber = "2",
  NumberofComponents = 0,
  ComponentofTranches = "0",
  TrancheName = "053-AS",
  TranchePrincipal = "notional",
  TranchePrincipalDesc = "NTL",
  TrancheInterestDesc = "INVIO",
  TrancheOtherDesc = "",
  Cusip = "3136AS4Y9",
  TrancheOrigBal = 38400349,
  TrancheInterest = "SMBS",
  TrancheCoupon = 5.55,
  AccrualRate = 0,
  TreasuryMaturity = 0,
  TreasuryYield = 0,
  TreasurySpread = 0,
  TrancheYield = 0,
  TranchePrice = 0,
  TrancheProceedsWithInterest = 0,
  TrancheAvgLife = 7.03937,
  TrancheDuration = 4.18927,
  TrancheDatedDate = "07-25-2016",
  TrancheFirstPmtDate = "08-25-2016",
  TrancheNextPmtDate = "08-25-2016",
  TrancheLastPmtDate = "02-25-2045",
  TrancheFinalPmtDate = "08-25-2046",
  Delay = 0,
  InterestPmtFrequency = 12,
  PrinPmtFrequency = 12,
  PacLowBand = 0,
  PacHighBand = 0,
  FloaterIndex = "LIBOR1BBA",
  InitialIndexValue = 0.45,
  FloaterMargin = 6.00,
  FloaterMultiplier = -1.0,
  FloaterCap = 6.00,
  FloaterFloor = 0.0,
  FloaterInitialCoupon = 5.55,
  FloaterResetFrequency = 12,
  FloaterFirstResetDate = "08-25-2016",
  FloaterFormula = function(Cap, Floor, Margin, Index, Multiplier){
  min(Cap, max((Index * Multiplier) + Margin, Floor))},
  Group = 1,
  Schedule = FALSE,
  Fixed = FALSE)
  
  MakeTranche(
  DealName = "FNMA2016053",
  TrancheNumber = "3",
  NumberofComponents = 0,
  ComponentofTranches = "0",
  TrancheName = "053-AB",
  TranchePrincipal = "pass-through",
  TranchePrincipalDesc = "PACAD",
  TrancheInterestDesc = "FIX",
  TrancheOtherDesc = "",
  Cusip = "3136AS4Z6",
  TrancheOrigBal = 63959530,
  TrancheInterest = "FIX",
  TrancheCoupon = 3.00,
  AccrualRate = 0,
  TreasuryMaturity = 0,
  TreasuryYield = 0,
  TreasurySpread = 0,
  TrancheYield = 0,
  TranchePrice = 0,
  TrancheProceedsWithInterest = 0,
  TrancheAvgLife = 4.71577,
  TrancheDuration = 3.79192,
  TrancheDatedDate = "07-01-2016",
  TrancheFirstPmtDate = "08-25-2016",
  TrancheNextPmtDate = "08-25-2016",
  TrancheLastPmtDate = "11-25-2027",
  TrancheFinalPmtDate = "05-25-2044",
  Delay = 24,
  InterestPmtFrequency = 12,
  PrinPmtFrequency = 12,
  PacLowBand = 130,
  PacHighBand = 250,
  FloaterIndex = "none",
  InitialIndexValue = 0,
  FloaterMargin = 0,
  FloaterMultiplier = 0,
  FloaterCap = 0,
  FloaterFloor = 0,
  FloaterInitialCoupon = 0,
  FloaterResetFrequency = 0,
  FloaterFirstResetDate = "00-00-0000",
  FloaterFormula = function(){3},
  Group = 1,
  Schedule = TRUE,
  Fixed = TRUE)
  
  MakeTranche(
  DealName = "FNMA2016053",
  TrancheNumber = "4",
  NumberofComponents = 0,
  ComponentofTranches = "0",
  TrancheName = "053-AV",
  TranchePrincipal = "pass-through",
  TranchePrincipalDesc = "PACAD",
  TrancheInterestDesc = "FIX",
  TrancheOtherDesc = "",
  Cusip = "3136AS5A0",
  TrancheOrigBal = 3456470,
  TrancheInterest = "FIX",
  TrancheCoupon = 3.00,
  AccrualRate = 0,
  TreasuryMaturity = 0,
  TreasuryYield = 0,
  TreasurySpread = 0,
  TrancheYield = 0,
  TranchePrice = 0,
  TrancheProceedsWithInterest = 0,
  TrancheAvgLife = 5.99453,
  TrancheDuration = 4.73157 ,
  TrancheDatedDate = "07-01-2016",
  TrancheFirstPmtDate = "08-25-2016",
  TrancheNextPmtDate = "08-25-2016",
  TrancheLastPmtDate = "11-25-2027",
  TrancheFinalPmtDate = "12-25-2027",
  Delay = 24,
  InterestPmtFrequency = 12,
  PrinPmtFrequency = 12,
  PacLowBand = 130,
  PacHighBand = 250,
  FloaterIndex = "none",
  InitialIndexValue = 0,
  FloaterMargin = 0,
  FloaterMultiplier = 0,
  FloaterCap = 0,
  FloaterFloor = 0,
  FloaterInitialCoupon = 0,
  FloaterResetFrequency = 0,
  FloaterFirstResetDate = "00-00-0000",
  FloaterFormula = function(){3},
  Group = 1,
  Schedule = TRUE,
  Fixed = TRUE)
  
  MakeTranche(
  DealName = "FNMA2016053",
  TrancheNumber = "5",
  NumberofComponents = 0,
  ComponentofTranches = "0",
  TrancheName = "053-AZ",
  TranchePrincipal = "pass-through",
  TranchePrincipalDesc = "PACAD",
  TrancheInterestDesc = "FIX_Z",
  TrancheOtherDesc = "",
  Cusip = "3136AS5B8",
  TrancheOrigBal = 8584874,
  TrancheInterest = "ACC",
  TrancheCoupon = 3.00,
  AccrualRate = 3.00,
  TreasuryMaturity = 0,
  TreasuryYield = 0,
  TreasurySpread = 0,
  TrancheYield = 0,
  TranchePrice = 0,
  TrancheProceedsWithInterest = 0,
  TrancheAvgLife = 15.77559,
  TrancheDuration = 14.56445,
  TrancheDatedDate = "07-01-2016",
  TrancheFirstPmtDate = "12-25-2027",
  TrancheNextPmtDate = "12-25-2027",
  TrancheLastPmtDate = "02-25-2045",
  TrancheFinalPmtDate = "08-25-2046",
  Delay = 24,
  InterestPmtFrequency = 12,
  PrinPmtFrequency = 12,
  PacLowBand = 130,
  PacHighBand = 250,
  FloaterIndex = "none",
  InitialIndexValue = 0,
  FloaterMargin = 0,
  FloaterMultiplier = 0,
  FloaterCap = 0,
  FloaterFloor = 0,
  FloaterInitialCoupon = 0,
  FloaterResetFrequency = 0,
  FloaterFirstResetDate = "00-00-0000",
  FloaterFormula = function(){3},
  Group = 1,
  Schedule = TRUE,
  Fixed = TRUE)
  
  MakeTranche(
  DealName = "FNMA2016053",
  TrancheNumber = "6",
  NumberofComponents = 0,
  ComponentofTranches = "0",
  TrancheName = "053-ZA",
  TranchePrincipal = "pass-through",
  TranchePrincipalDesc = "SUP",
  TrancheInterestDesc = "FIX_Z",
  TrancheOtherDesc = "",
  Cusip = "3136AS5C6",
  TrancheOrigBal = 20000000,
  TrancheInterest = "ACC",
  TrancheCoupon = 3.00,
  AccrualRate = 3.00,
  TreasuryMaturity = 0,
  TreasuryYield = 0,
  TreasurySpread = 0,
  TrancheYield = 0,
  TranchePrice = 0,
  TrancheProceedsWithInterest = 0,
  TrancheAvgLife = 9.21202,
  TrancheDuration = 5.11928,
  TrancheDatedDate = "07-01-2016",
  TrancheFirstPmtDate = "08-25-2016",
  TrancheNextPmtDate = "08-25-2016",
  TrancheLastPmtDate = "02-25-2045",
  TrancheFinalPmtDate = "08-25-2046",
  Delay = 24,
  InterestPmtFrequency = 12,
  PrinPmtFrequency = 12,
  PacLowBand = 130,
  PacHighBand = 250,
  FloaterIndex = "none",
  InitialIndexValue = 0,
  FloaterMargin = 0,
  FloaterMultiplier = 0,
  FloaterCap = 0,
  FloaterFloor = 0,
  FloaterInitialCoupon = 0,
  FloaterResetFrequency = 0,
  FloaterFirstResetDate = "00-00-0000",
  FloaterFormula = function(){3},
  Group = 1,
  Schedule = TRUE,
  Fixed = TRUE)
